<article class="page" aria-labelledby="detail-heading">
  @if (loading()) {
    <p class="loading" role="status" aria-live="polite">Yükleniyor…</p>
  } @else if (error() || !item()) {
    <p class="error" role="alert">{{ error() || 'Ürün bulunamadı.' }}</p>
    <a routerLink="/stock">Stok listesine dön</a>
  } @else {
    <header class="page-header">
      <h1 id="detail-heading">{{ item()!.product?.name ?? 'Stok' }} – Stok detayı</h1>
      <p class="meta">Depo: {{ item()!.warehouse?.name ?? '-' }}</p>
      @if (item()!.imageKey || item()!.product?.imageKey) {
        <img
          [src]="imageUrl()"
          alt="{{ item()!.product?.name ?? 'Ürün' }} resmi"
          class="product-image"
        />
      }
    </header>

    <section class="detail-card" aria-labelledby="current-stock-heading">
      <h2 id="current-stock-heading">Mevcut miktar</h2>
      <p class="quantity">{{ item()!.quantity }}</p>
    </section>

    <section class="form-section image-section" aria-labelledby="image-heading">
      <h2 id="image-heading">Ürün resmi</h2>
      @if (imageSuccess()) {
        <p class="success" role="status">Resim yüklendi.</p>
      }
      @if (imageError()) {
        <p class="save-error" role="alert">{{ imageError() }}</p>
      }
      <form (ngSubmit)="onImageSubmit()" class="image-form">
        <input
          type="file"
          accept="image/jpeg,image/png,image/gif,image/webp"
          (change)="onImageFileChange($event)"
          #fileInput
        />
        <button type="submit" [disabled]="!selectedImageFile() || uploadingImage()">
          {{ uploadingImage() ? 'Yükleniyor…' : 'Resim yükle (S3)' }}
        </button>
      </form>
    </section>

    <section class="form-section" aria-labelledby="update-heading">
      <h2 id="update-heading">Stok miktarı güncelle</h2>
      @if (saveSuccess()) {
        <p class="success" role="status">Stok güncellendi.</p>
      }
      @if (saveError()) {
        <p class="save-error" role="alert">{{ saveError() }}</p>
      }
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <label for="quantity">Yeni miktar</label>
        <input
          id="quantity"
          type="number"
          formControlName="quantity"
          min="0"
          aria-describedby="quantity-hint"
        />
        <span id="quantity-hint" class="hint">Sadece Admin yetkisi ile güncellenir.</span>
        <button type="submit" [disabled]="form.invalid || saving()">
          {{ saving() ? 'Kaydediliyor…' : 'Kaydet' }}
        </button>
      </form>
    </section>

    <a routerLink="/stock" class="back-link">← Stok listesine dön</a>
  }
</article>
