<article class="register-page" aria-labelledby="register-heading">
  <h1 id="register-heading">Kayıt ol</h1>
  <p class="register-desc">Hesap oluşturup sipariş verebilirsiniz.</p>

  @if (error()) {
    <p class="error" role="alert">{{ error() }}</p>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="register-form">
    <div class="field">
      <label for="username">Kullanıcı adı</label>
      <input id="username" type="text" formControlName="username" autocomplete="username" />
      @if (form.controls.username.invalid && form.controls.username.touched) {
        <span class="field-error">Kullanıcı adı gerekli (en az 2 karakter)</span>
      }
    </div>
    <div class="field">
      <label for="email">E-posta</label>
      <input id="email" type="email" formControlName="email" autocomplete="email" />
      @if (form.controls.email.invalid && form.controls.email.touched) {
        <span class="field-error">Geçerli bir e-posta girin</span>
      }
    </div>
    <div class="field">
      <label for="password">Şifre</label>
      <input id="password" type="password" formControlName="password" autocomplete="new-password" />
      @if (form.controls.password.invalid && form.controls.password.touched) {
        <span class="field-error">Şifre gerekli (en az 6 karakter)</span>
      }
    </div>
    <div class="field">
      <label for="firstName">Ad</label>
      <input id="firstName" type="text" formControlName="firstName" autocomplete="given-name" />
      @if (form.controls.firstName.invalid && form.controls.firstName.touched) {
        <span class="field-error">Ad gerekli</span>
      }
    </div>
    <div class="field">
      <label for="lastName">Soyad</label>
      <input id="lastName" type="text" formControlName="lastName" autocomplete="family-name" />
      @if (form.controls.lastName.invalid && form.controls.lastName.touched) {
        <span class="field-error">Soyad gerekli</span>
      }
    </div>
    <div class="field">
      <label for="address">Adres</label>
      <textarea id="address" formControlName="address" rows="2"></textarea>
    </div>
    <div class="field">
      <label for="cityId">İl</label>
      <select id="cityId" formControlName="cityId" (change)="onCityChange()">
        <option [ngValue]="0">Seçiniz</option>
        @for (c of cities(); track c.id) {
          <option [ngValue]="c.id">{{ c.name }} ({{ c.plateCode }})</option>
        }
      </select>
    </div>
    <div class="field">
      <label for="districtId">İlçe</label>
      <select id="districtId" formControlName="districtId">
        <option [ngValue]="0">Seçiniz</option>
        @for (d of districts(); track d.id) {
          <option [ngValue]="d.id">{{ d.name }}</option>
        }
      </select>
    </div>
    <div class="field">
      <label for="cardLast4">Kredi kartı son 4 hane (opsiyonel)</label>
      <input id="cardLast4" type="text" formControlName="cardLast4" maxlength="4" placeholder="1234" inputmode="numeric" />
      @if (form.controls.cardLast4.invalid && form.controls.cardLast4.touched) {
        <span class="field-error">Sadece 4 rakam</span>
      }
    </div>
    <button type="submit" [disabled]="loading()">
      {{ loading() ? 'Kaydediliyor…' : 'Kayıt ol' }}
    </button>
  </form>

  <p class="back">
    Zaten hesabınız var mı? <a routerLink="/giris">Giriş yap</a>
  </p>
</article>
